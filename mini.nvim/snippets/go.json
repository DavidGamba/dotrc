{
  "iferr": {
    "body": [
      "if err != nil {",
      "\treturn fmt.Errorf(\"failed to $0: %w\", err)",
      "}"
    ],
    "prefix": "iferr"
  },
  "command": {
    "body": [
      "// ${1:command} -",
      "func $1(ctx context.Context, opt *getoptions.GetOpt, args []string) error {",
      "\tLogger.Printf(\"$1\")",
      "\t$0",
      "\treturn nil",
      "}"
    ],
    "prefix": "command"
  },
  "checkFile": {
    "body": [
      "if _, err := os.Stat($1); os.IsNotExist(err) {",
      "  ${2:// file does not exist}",
      "\t$0",
      "}"
    ],
    "prefix": "checkFile"
  },
  "open": {
    "prefix": "open",
    "body": [
      "${1:fh}, err := os.Open($2)",
      "if err != nil {",
      "\t${3:return err}",
      "}",
      "$0"
    ]
  },
  "maincmd": {
    "body": [
      "package main",
      "",
      "import (",
      "\t\"context\"",
      "\t\"errors\"",
      "\t\"fmt\"",
      "\t\"io\"",
      "\t\"log\"",
      "\t\"os\"",
      "",
      "\t\"github.com/DavidGamba/dgtools/run\"",
      "\t\"github.com/DavidGamba/go-getoptions\"",
      ")",
      "",
      "var Logger = log.New(os.Stderr, \"\", log.LstdFlags)",
      "",
      "func main() {",
      "\tos.Exit(program(os.Args))",
      "}",
      "",
      "func program(args []string) int {",
      "\topt := getoptions.New()",
      "\topt.Bool(\"quiet\", false, opt.GetEnv(\"QUIET\"))",
      "\topt.SetUnknownMode(getoptions.Pass)",
      "\topt.NewCommand(\"cmd\", \"description\").SetCommandFn(Run)",
      "\topt.HelpCommand(\"help\", opt.Alias(\"?\"))",
      "\tremaining, err := opt.Parse(args[1:])",
      "\tif err != nil {",
      "\t\tfmt.Fprintf(os.Stderr, \"ERROR: %s\\n\", err)",
      "\t\treturn 1",
      "\t}",
      "\tif opt.Called(\"quiet\") {",
      "\t\tLogger.SetOutput(io.Discard)",
      "\t}",
      "\tLogger.Println(remaining)",
      "",
      "\tctx, cancel, done := getoptions.InterruptContext()",
      "\tdefer func() { cancel(); <-done }()",
      "",
      "\terr = opt.Dispatch(ctx, remaining)",
      "\tif err != nil {",
      "\t\tif errors.Is(err, getoptions.ErrorHelpCalled) {",
      "\t\t\treturn 1",
      "\t\t}",
      "\t\tfmt.Fprintf(os.Stderr, \"ERROR: %s\\n\", err)",
      "\t\treturn 1",
      "\t}",
      "\treturn 0",
      "}",
      "",
      "func Run(ctx context.Context, opt *getoptions.GetOpt, args []string) error {",
      "\tLogger.Printf(\"Running\")",
      "",
      "\tcmd := []string{\"echo\", \"hello\", \"world\"}",
      "\terr := run.CMD(cmd...).Log().Run()",
      "\tif err != nil {",
      "\t\treturn fmt.Errorf(\"failed: %w\", err)",
      "\t}",
      "\treturn nil",
      "}"
    ],
    "prefix": "maincmd"
  },
  "main": {
    "body": [
      "package main",
      "",
      "import (",
      "\t\"context\"",
      "\t\"errors\"",
      "\t\"fmt\"",
      "\t\"io\"",
      "\t\"log\"",
      "\t\"os\"",
      "",
      "\t\"github.com/DavidGamba/dgtools/run\"",
      "\t\"github.com/DavidGamba/go-getoptions\"",
      ")",
      "",
      "var Logger = log.New(os.Stderr, \"\", log.LstdFlags)",
      "",
      "func main() {",
      "\tos.Exit(program(os.Args))",
      "}",
      "",
      "func program(args []string) int {",
      "\topt := getoptions.New()",
      "\topt.SetUnknownMode(getoptions.Pass)",
      "\topt.Bool(\"quiet\", false, opt.GetEnv(\"QUIET\"))",
      "\topt.SetCommandFn(Run)",
      "\topt.HelpCommand(\"help\", opt.Alias(\"?\"))",
      "\tremaining, err := opt.Parse(args[1:])",
      "\tif err != nil {",
      "\t\tfmt.Fprintf(os.Stderr, \"ERROR: %s\\n\", err)",
      "\t\treturn 1",
      "\t}",
      "\tif opt.Called(\"quiet\") {",
      "\t\tLogger.SetOutput(io.Discard)",
      "\t}",
      "\tLogger.Println(remaining)",
      "",
      "\tctx, cancel, done := getoptions.InterruptContext()",
      "\tdefer func() { cancel(); <-done }()",
      "",
      "\terr = opt.Dispatch(ctx, remaining)",
      "\tif err != nil {",
      "\t\tif errors.Is(err, getoptions.ErrorHelpCalled) {",
      "\t\t\treturn 1",
      "\t\t}",
      "\t\tfmt.Fprintf(os.Stderr, \"ERROR: %s\\n\", err)",
      "\t\tif errors.Is(err, getoptions.ErrorParsing) {",
      "\t\t\tfmt.Fprintf(os.Stderr, \"\\n\"+opt.Help())",
      "\t\t}",
      "\t\treturn 1",
      "\t}",
      "\treturn 0",
      "}",
      "",
      "func Run(ctx context.Context, opt *getoptions.GetOpt, args []string) error {",
      "\tLogger.Printf(\"Running\")",
      "",
      "\tcmd := []string{\"echo\", \"hello\", \"world\"}",
      "\terr := run.CMD(cmd...).Log().Run()",
      "\tif err != nil {",
      "\t\treturn fmt.Errorf(\"failed: %w\", err)",
      "\t}",
      "\treturn nil",
      "}"
    ],
    "description": "single level script",
    "prefix": [
      "main"
    ]
  },
  "subcommand": {
    "body": [
      "package \\${1:packagename}",
      "",
      "import (",
      "\t\"log\"",
      "\t\"os\"",
      "",
      "\t\"github.com/DavidGamba/go-getoptions\"",
      ")",
      "",
      "var Logger = log.New(os.Stderr, \"\", log.LstdFlags)",
      "",
      "func NewCommand(parent *getoptions.GetOpt) *getoptions.GetOpt {",
      "\topt := parent.NewCommand(\"\\$1\", \"\\$1 related tasks\")",
      "\treturn opt",
      "}",
      "endsnippet",
      "",
      "snippet newsubcommand",
      "func \\${1:subcommandname}CMD(parent *getoptions.GetOpt) *getoptions.GetOpt {",
      "\topt := parent.NewCommand(\"`!p snip.rv = t[1].lower()`\", \"\")",
      "\topt.SetCommandFn(\\$1Run)",
      "\treturn opt",
      "}",
      "",
      "func \\$1Run(ctx context.Context, opt *getoptions.GetOpt, args []string) error {",
      "\t\\$0",
      "\treturn nil",
      "}"
    ],
    "prefix": "subcommand"
  },
  "NewCommand": {
    "body": [
      "func $1Command(parent *getoptions.GetOpt) *getoptions.GetOpt {",
      "\topt := parent.NewCommand(\"$2\", \"$2 related tasks\")",
      "\topt.SetCommandFn($1Run)",
      "\treturn opt",
      "}"
    ],
    "prefix": "NewCommand"
  }
}
